<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1280">
    <title>EIdos - Gestion de compte</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <style>
        #account-sidebar nav button, #account-sidebar nav a {
            display: flex; align-items: center; width: 100%; padding: 0.75rem 1rem;
            border-radius: 0.5rem; transition: background-color 0.2s ease, color 0.2s ease;
            text-align: left; font-weight: 500; color: #374151;
        }
        #account-sidebar nav button:hover, #account-sidebar nav a:hover { background-color: #f3f4f6; }
        #account-sidebar nav button.active, #account-sidebar nav a.active { background-color: #0d9488; color: white; font-weight: 600; }
        #account-sidebar nav button i, #account-sidebar nav a i { width: 1.25rem; margin-right: 0.75rem; text-align: center; }
        .account-section { display: none; }
        .account-section.active { display: block; animation: fadeIn 0.5s ease-in-out; }
        
        /* Admin Styles */
        .admin-card { transition: transform 0.2s; }
        .admin-card:hover { transform: translateY(-2px); }
        
        /* Colonnes interactives */
        .admin-col-item { cursor: pointer; transition: all 0.2s; border-left: 4px solid transparent; }
        .admin-col-item:hover { background-color: #f9fafb; }
        .admin-col-item.selected { background-color: #f0fdfa; border-left-color: #0d9488; }
    </style>
</head>
<body class="bg-gray-100">

    <div class="flex h-screen">
        <aside id="account-sidebar" class="w-64 bg-white shadow-xl flex flex-col flex-shrink-0 m-4 rounded-2xl h-[calc(100vh-2rem)]">
            <div class="p-4 bg-gradient-to-br from-teal-500 to-cyan-600 text-white rounded-t-2xl">
                <div class="flex items-center space-x-3">
                    <svg class="h-10 w-10 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.125 2.25h-4.5c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9M10.125 2.25h.375a9 9 0 0 1 9 9v.375M10.125 2.25A3.375 3.375 0 0 1 13.5 5.625v1.5c0 .621.504 1.125 1.125 1.125h1.5a3.375 3.375 0 0 1 3.375 3.375M9 15l2.25 2.25L15 12" />
                    </svg>
                    <div>
                         <h1 class="text-2xl font-bold" style="font-family: 'Parkinsans', sans-serif; font-weight: 600;">EIdos</h1>
                        <p class="text-xs text-cyan-100">Gestion de compte</p>
                    </div>
                </div>
            </div>
            <nav class="flex-1 p-2 space-y-1">
                <button type="button" id="tab-security" class="account-tab-btn active"><i class="fas fa-shield-alt"></i> Sécurité</button>
                <button type="button" id="tab-subscription" class="account-tab-btn"><i class="fas fa-rocket"></i> Abonnement</button>
                <button type="button" id="tab-centre" class="account-tab-btn" style="display: none;"><i class="fas fa-building"></i> Gestion du Centre</button>
                <button type="button" id="tab-invitations" class="account-tab-btn"><i class="fas fa-users"></i> Gestion des étudiants</button>
                <button type="button" id="tab-admin" class="account-tab-btn text-red-600 hover:bg-red-50" style="display: none;"><i class="fas fa-user-shield"></i> Administration</button>
                <button type="button" id="tab-contact" class="account-tab-btn"><i class="fas fa-envelope"></i> Contacter le développeur</button>
            </nav>
            <div class="p-2 border-t border-gray-100">
                <a href="simul.html" class="block w-full text-left text-sm text-blue-600 hover:bg-blue-100 p-2 rounded-md transition-colors mb-1">
                    <i class="fas fa-arrow-left w-6 text-center mr-1"></i> Retour au simulateur
                </a>
            </div>
        </aside>

        <div class="flex-1 flex flex-col overflow-hidden m-4 h-[calc(100vh-2rem)]">
            <div id="main-content-wrapper" class="flex-1 overflow-x-hidden overflow-y-auto">
                <main class="p-4 md:p-6 lg:p-8">

                    <section id="content-security" class="account-section active">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6">Sécurité</h1>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="card p-6">
                                <h2 class="card-header header-teal">Changer le mot de passe</h2>
                                <form id="change-password-form" class="mt-6 space-y-4">
                                    <div><label class="block text-sm font-medium text-gray-700">Mot de passe actuel</label><input type="password" id="current-password" class="styled-input mt-1" required></div>
                                    <div><label class="block text-sm font-medium text-gray-700">Nouveau mot de passe</label><input type="password" id="new-password" class="styled-input mt-1" required></div>
                                    <div><label class="block text-sm font-medium text-gray-700">Confirmer</label><input type="password" id="confirm-password" class="styled-input mt-1" required></div>
                                    <div class="flex justify-end"><button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-teal-600 hover:bg-teal-700">Mettre à jour</button></div>
                                </form>
                            </div>
                            <div class="card p-6">
                                <h2 class="card-header header-teal">Changer l'adresse e-mail</h2>
                                <form id="change-email-form" class="mt-6 space-y-4">
                                    <p class="text-sm text-gray-600">Un lien de vérification sera envoyé.</p>
                                    <div><label class="block text-sm font-medium text-gray-700">Nouvelle adresse</label><input type="email" id="new-email" class="styled-input mt-1" required></div>
                                    <div><label class="block text-sm font-medium text-gray-700">Mot de passe actuel</label><input type="password" id="current-password-for-email" class="styled-input mt-1" required></div>
                                    <div class="flex justify-end"><button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-teal-600 hover:bg-teal-700">Demander le changement</button></div>
                                </form>
                            </div>
                        </div>
                        <div class="card p-6 mt-8 border-red-300">
                            <h2 class="card-header header-rose">Zone de danger</h2>
                            <div class="mt-6 flex justify-between items-center">
                                <p class="text-sm text-gray-700">La suppression est irréversible.</p>
                                <button id="delete-account-btn" type="button" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700">Supprimer mon compte</button>
                            </div>
                        </div>
                    </section>

                    <section id="content-subscription" class="account-section">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6">Abonnement</h1>
                        <div class="card p-6 transition-none mb-8">
                            <h2 class="card-header header-blue">Votre abonnement actuel</h2>
                            <div class="mt-6">
                                <p class="text-lg">Plan : <strong id="current-plan-name" class="text-blue-600">...</strong></p>
                                <p id="plan-description" class="text-gray-600 mt-2">Chargement...</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 items-start">
                            <div class="card bg-white p-6 flex flex-col border-t-4 border-yellow-300 h-full">
                                <span class="js-active-plan-badge hidden absolute top-0 right-0 -mt-3 mr-3 text-xs font-bold bg-yellow-300 text-yellow-800 px-3 py-1 rounded-full shadow-lg">Actuel</span>
                                <h3 class="text-2xl font-semibold text-yellow-700">Free</h3>
                                <p class="text-4xl font-extrabold my-4">Gratuit</p>
                                <button id="sub-btn-free" class="mt-auto w-full py-3 px-4 rounded-lg font-semibold text-yellow-700 bg-yellow-50 hover:bg-yellow-100">Choisir</button>
                            </div>
                            <div class="card bg-white p-6 flex flex-col border-t-4 border-teal-600 h-full">
                                <span class="js-active-plan-badge hidden absolute top-0 right-0 -mt-3 mr-3 text-xs font-bold bg-teal-600 text-white px-3 py-1 rounded-full shadow-lg">Actuel</span>
                                <h3 class="text-2xl font-semibold text-teal-700">Indépendant</h3>
                                <p class="text-4xl font-extrabold my-4">__€</p>
                                <button id="sub-btn-independant" class="mt-auto w-full py-3 px-4 rounded-lg font-semibold text-white bg-teal-600 hover:bg-teal-700">Choisir</button>
                            </div>
                            <div class="card bg-white p-6 flex flex-col border-t-4 border-blue-600 h-full">
                                <span class="js-active-plan-badge hidden absolute top-0 right-0 -mt-3 mr-3 text-xs font-bold bg-blue-600 text-white px-3 py-1 rounded-full shadow-lg">Actuel</span>
                                <h3 class="text-2xl font-semibold text-blue-700">Promo</h3>
                                <p class="text-4xl font-extrabold my-4">__€</p>
                                <button id="sub-btn-promo" class="mt-auto w-full py-3 px-4 rounded-lg font-semibold text-white bg-blue-600 hover:bg-blue-700">Choisir</button>
                            </div>
                            <div class="card bg-white p-6 flex flex-col border-t-4 border-indigo-600 h-full">
                                <span class="js-active-plan-badge hidden absolute top-0 right-0 -mt-3 mr-3 text-xs font-bold bg-indigo-600 text-white px-3 py-1 rounded-full shadow-lg">Actuel</span>
                                <h3 class="text-2xl font-semibold text-indigo-700">Centre</h3>
                                <p class="text-4xl font-extrabold my-4">Devis</p>
                                <button id="sub-btn-centre" class="mt-auto w-full py-3 px-4 rounded-lg font-semibold text-gray-700 bg-gray-200">Contacter</button>
                            </div>
                        </div>
                    </section>
                    
                    <section id="content-centre" class="account-section">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6">Gestion du Centre</h1>
                        <div class="card p-6 mb-8">
                            <h2 class="card-header header-indigo">Statut</h2>
                            <p class="mt-4 text-lg"><strong id="centre-plan-name" class="text-indigo-600">...</strong></p>
                            <p id="centre-plan-details" class="text-gray-600">...</p>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="card p-6">
                                <h2 class="card-header header-indigo">Inviter un formateur</h2>
                                <form id="invite-formateur-form" class="mt-6 space-y-4">
                                    <input type="email" id="invite-email" class="styled-input" placeholder="collegue@ifsi.fr" required>
                                    <div class="flex justify-end"><button type="submit" id="invite-formateur-btn" class="btn bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Envoyer</button></div>
                                </form>
                            </div>
                            <div class="card p-6">
                                <h2 class="card-header header-indigo">Formateurs rattachés</h2>
                                <div id="formateurs-list-container" class="mt-4 space-y-2"><p class="text-gray-500">Chargement...</p></div>
                            </div>
                        </div>
                    </section>
                    
                    <!-- SECTION ADMIN REFONDUE -->
                    <section id="content-admin" class="account-section">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="text-3xl font-bold text-gray-800">Administration Système</h1>
                            <span class="bg-red-100 text-red-800 text-xs font-bold px-3 py-1 rounded-full uppercase">Super Admin</span>
                        </div>

                        <!-- KPI Stats -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                            <div class="bg-white p-4 rounded-xl shadow-md border-l-4 border-blue-500">
                                <p class="text-xs text-gray-500 uppercase">Utilisateurs</p>
                                <p class="text-2xl font-bold text-gray-800" id="admin-stat-users">...</p>
                            </div>
                            <div class="bg-white p-4 rounded-xl shadow-md border-l-4 border-teal-500">
                                <p class="text-xs text-gray-500 uppercase">Dossiers</p>
                                <p class="text-2xl font-bold text-gray-800" id="admin-stat-patients">...</p>
                            </div>
                            <div class="bg-white p-4 rounded-xl shadow-md border-l-4 border-indigo-500">
                                <p class="text-xs text-gray-500 uppercase">Centres</p>
                                <p class="text-2xl font-bold text-gray-800" id="admin-stat-orgs">...</p>
                            </div>
                            <div class="bg-white p-4 rounded-xl shadow-md border-l-4 border-yellow-500">
                                <p class="text-xs text-gray-500 uppercase">Étudiants</p>
                                <p class="text-2xl font-bold text-gray-800" id="admin-stat-students">...</p>
                            </div>
                        </div>

                        <!-- Admin Tabs -->
                        <div class="flex space-x-4 mb-6 border-b border-gray-200">
                            <button id="admin-view-users-btn" class="pb-2 px-4 font-medium text-teal-600 border-b-2 border-teal-600 focus:outline-none">
                                <i class="fas fa-sitemap mr-2"></i> Base de Données (Hierarchique)
                            </button>
                            <button id="admin-view-scenarios-btn" class="pb-2 px-4 font-medium text-gray-500 hover:text-teal-600 focus:outline-none">
                                <i class="fas fa-book-medical mr-2"></i> Bibliothèque de Cas
                            </button>
                        </div>

                        <!-- VUE HIERARCHIQUE (3 COLONNES) -->
                        <div id="admin-view-users">
                            <div class="grid grid-cols-3 gap-4 h-[600px]">
                                <!-- Colonne 1 : Centres -->
                                <div class="bg-white rounded-lg shadow border border-gray-200 flex flex-col overflow-hidden">
                                    <div class="bg-indigo-50 px-4 py-3 border-b border-indigo-100 font-bold text-indigo-800">
                                        <i class="fas fa-building mr-2"></i>Centres
                                    </div>
                                    <div id="admin-col-centres" class="flex-1 overflow-y-auto divide-y divide-gray-100">
                                        <!-- Liste des centres injectée ici -->
                                    </div>
                                </div>

                                <!-- Colonne 2 : Formateurs -->
                                <div class="bg-white rounded-lg shadow border border-gray-200 flex flex-col overflow-hidden">
                                    <div class="bg-teal-50 px-4 py-3 border-b border-teal-100 font-bold text-teal-800">
                                        <i class="fas fa-chalkboard-teacher mr-2"></i>Formateurs
                                    </div>
                                    <div id="admin-col-formateurs" class="flex-1 overflow-y-auto divide-y divide-gray-100">
                                        <div class="p-4 text-center text-gray-400 text-sm italic">Sélectionnez un centre</div>
                                    </div>
                                </div>

                                <!-- Colonne 3 : Étudiants -->
                                <div class="bg-white rounded-lg shadow border border-gray-200 flex flex-col overflow-hidden">
                                    <div class="bg-yellow-50 px-4 py-3 border-b border-yellow-100 font-bold text-yellow-800">
                                        <i class="fas fa-user-graduate mr-2"></i>Étudiants
                                    </div>
                                    <div id="admin-col-students" class="flex-1 overflow-y-auto divide-y divide-gray-100">
                                        <div class="p-4 text-center text-gray-400 text-sm italic">Sélectionnez un formateur</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- VUE SCENARIOS -->
                        <div id="admin-view-scenarios" class="hidden">
                            <div class="flex justify-between items-center mb-4">
                                <input type="text" id="admin-search-scenarios" class="styled-input w-2/3" placeholder="Rechercher un dossier...">
                                <div class="flex items-center space-x-2">
                                    <select id="admin-filter-scenarios" class="styled-input py-1">
                                        <option value="all">Tout</option>
                                        <option value="public">Public</option>
                                        <option value="private">Privé</option>
                                    </select>
                                </div>
                            </div>
                            <div id="admin-scenarios-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- Cartes scénarios injectées ici -->
                            </div>
                        </div>
                    </section>

                    <section id="content-invitations" class="account-section">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6">Invitations et Gestion (Étudiants)</h1>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="card p-6">
                                <h2 class="card-header header-indigo">Créer des comptes étudiants</h2>
                                <form id="create-student-form" class="mt-6 space-y-4">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div><label class="block text-sm font-medium text-gray-700">Identifiant</label><input type="text" id="student-login" class="styled-input mt-1" required></div>
                                        <div><label class="block text-sm font-medium text-gray-700">Mot de passe</label><input type="text" id="student-password" class="styled-input mt-1" required></div>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <button type="button" id="generate-credentials-btn" class="text-sm text-blue-600 hover:underline"><i class="fas fa-random mr-1"></i> Suggérer</button>
                                        <button type="submit" id="create-student-submit-btn" class="btn bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700"><i class="fas fa-plus mr-2"></i> Créer</button>
                                    </div>
                                </form>
                            </div>
                            <div class="card p-6 bg-yellow-50 border-yellow-300">
                                <h2 class="card-header header-orange" style="color: #c2410c; border-bottom-color: #fdba74;">Info Mots de passe</h2>
                                <div class="mt-6 text-sm text-gray-700">EIdos ne stocke pas les mots de passe. Notez-les maintenant. En cas d'oubli, supprimez et recréez le compte.</div>
                            </div>
                        </div>
                        <div class="card p-6 mt-8">
                            <h2 class="card-header header-indigo" id="student-list-title">Gestion des étudiants (0)</h2>
                            <div class="overflow-x-auto mt-4">
                                <table class="w-full border-collapse text-sm diagram" id="permissions-table">
                                    <thead class="bg-gray-100 text-gray-600">
                                        <tr>
                                            <th class="p-2 text-left">Login</th>
                                            <th class="p-2 text-center">En-tête</th><th class="p-2 text-center">Admin</th><th class="p-2 text-center">Vie</th><th class="p-2 text-center">Obs</th>
                                            <th class="p-2 text-center">CR</th><th class="p-2 text-center">Presc(+)</th><th class="p-2 text-center">Presc(-)</th><th class="p-2 text-center">Presc(V)</th>
                                            <th class="p-2 text-center">Trans</th><th class="p-2 text-center">Pancarte</th><th class="p-2 text-center">Diag</th><th class="p-2 text-center">Bio</th>
                                            <th class="p-2 text-center">Chambres</th><th class="p-2 text-center">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="permissions-tbody"><tr><td colspan="15" class="p-4 text-center">Aucun étudiant.</td></tr></tbody>
                                </table>
                            </div>
                        </div>
                    </section>
                    
                    <section id="content-contact" class="account-section">
                        <h1 class="text-3xl font-bold text-gray-800 mb-6">Contact</h1>
                        <div class="mt-10 grid grid-cols-1 md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                            <div class="card p-8 flex flex-col items-center text-center border-t-4 border-teal-500">
                                <span class="h-16 w-16 bg-teal-100 text-teal-600 rounded-full text-3xl mb-6 flex items-center justify-center"><i class="fas fa-envelope"></i></span>
                                <h2 class="text-2xl font-semibold mb-3">Email</h2>
                                <p id="contact-email" class="text-lg font-medium text-teal-700 bg-teal-50 p-3 rounded-lg mb-4">lucas.seraudie@gmail.com</p>
                                <button id="copy-email-btn" class="btn bg-teal-600 text-white px-4 py-2 rounded">Copier</button>
                            </div>
                            <div class="card p-8 flex flex-col items-center text-center border-t-4 border-blue-600">
                                <span class="h-16 w-16 bg-blue-100 text-blue-600 rounded-full text-3xl mb-6 flex items-center justify-center"><i class="fab fa-linkedin"></i></span>
                                <h2 class="text-2xl font-semibold mb-3">LinkedIn</h2>
                                <a href="https://fr.linkedin.com/in/lucas-s%C3%A9raudie-1858ba14b" target="_blank" class="btn bg-blue-600 text-white px-4 py-2 rounded mt-4">Voir le profil</a>
                            </div>
                        </div>
                    </section>
                </main>
            </div>
        </div>
    </div>

    <!-- Modales (Confirm & Room) -->
    <div id="custom-confirm-modal" class="fixed inset-0 bg-gray-900 bg-opacity-60 hidden z-[10001] flex items-center justify-center"><div id="custom-confirm-box" class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md m-4 transition-all scale-95 opacity-0"><h3 id="custom-confirm-title" class="text-lg font-bold">Confirmation</h3><p id="custom-confirm-message" class="mt-2 text-sm text-gray-600"></p><div class="mt-6 flex justify-end space-x-3"><button id="custom-confirm-cancel" class="px-4 py-2 text-sm font-medium bg-gray-100 rounded-lg">Annuler</button><button id="custom-confirm-ok" class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg">Confirmer</button></div></div></div>
    <div id="room-modal" class="fixed inset-0 bg-gray-900 bg-opacity-60 hidden z-[10002] flex items-center justify-center"><div id="room-modal-box" class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md m-4 transition-all scale-95 opacity-0"><h3 id="room-modal-title" class="text-lg font-bold">Gérer les chambres</h3><form id="room-modal-form" class="mt-4"><input type="hidden" id="room-modal-login"><div id="room-modal-list" class="grid grid-cols-5 gap-2"></div><div class="mt-6 flex justify-end space-x-3"><button id="room-modal-cancel" type="button" class="px-4 py-2 bg-gray-100 rounded-lg">Annuler</button><button id="room-modal-save" type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg">Enregistrer</button></div></form></div></div>

    <script src="apiService.js"></script>
    <script src="utils.js"></script>
    <script src="uiService.js"></script>
    <script src="patientService.js"></script>
    <script src="account.js"></script>
</body>
</html>